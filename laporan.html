<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laporan Perjumpaan Kokurikulum SK Kepangian</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background: #f1f5f9; }
        @media print {
            .no-print { display: none !important; }
            body { background: white; padding: 0; margin: 0; }
            #reportSection { display: block !important; }
            .page-break { page-break-after: always; clear: both; }
            @page { size: A4; margin: 0.5cm; }
            .luxury-frame { margin: 0 auto !important; width: 100% !important; border-width: 8px !important; min-height: 275mm !important; }
        }
        .luxury-frame { border: 12px double #1e3a8a; outline: 2px solid #b45309; outline-offset: -18px; padding: 40px; background: white; width: 210mm; margin: 20px auto; position: relative; box-sizing: border-box; min-height: 275mm; display: flex; flex-direction: column; }
        .report-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .report-table th { background: #f1f5f9; color: #1e3a8a; border: 1px solid #64748b; padding: 8px; font-size: 11px; text-align: left; text-transform: uppercase; }
        .report-table td { border: 1px solid #64748b; padding: 8px; font-size: 12px; line-height: 1.4; }
        .image-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .image-grid img { width: 100%; height: 170px; object-fit: cover; border: 2px solid #1e3a8a; }
    </style>
</head>
<body class="py-10">

    <div id="inputForm" class="max-w-4xl mx-auto bg-white p-8 rounded-xl shadow-xl no-print border-t-8 border-blue-900 mb-10">
        <div class="text-center mb-8">
            <img src="https://i.postimg.cc/kVCz4Wgj/logo-sk-kepangian.png" alt="Logo" class="mx-auto w-24 mb-4">
            <h1 class="text-3xl font-bold text-blue-900 uppercase">Laporan Kokurikulum</h1>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <div>
                <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Unit Kokurikulum</label>
                <select id="unitSelect" onchange="resetAttendance()" class="w-full border-2 p-3 rounded-lg border-gray-200 font-semibold">
                    <option value="">-- Pilih Unit --</option>
                    <optgroup label="Unit Beruniform">
                        <option value="pengakap">PENGAKAP KANAK-KANAK</option>
                        <option value="bsmm">BULAN SABIT MERAH (BSMM)</option>
                        <option value="tkrs">TUNAS KADET REMAJA SEKOLAH (TKRS)</option>
                    </optgroup>
                    <optgroup label="Sukan & Permainan">
                        <option value="badminton">KELAB BADMINTON</option>
                        <option value="bola_baling">KELAB BOLA BALING</option>
                        <option value="catur">KELAB CATUR</option>
                    </optgroup>
                    <optgroup label="Kelab & Persatuan">
                        <option value="bm">PERSATUAN BAHASA MELAYU</option>
                        <option value="bi">PERSATUAN BAHASA INGGERIS</option>
                        <option value="stem">KELAB STEM</option>
                    </optgroup>
                </select>
            </div>
            <div>
                <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Perjumpaan Kali Ke-</label>
                <input type="number" id="meetingNum" class="w-full border-2 p-3 rounded-lg border-gray-200">
            </div>
        </div>

        <div class="mb-6">
            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Tajuk Aktiviti</label>
            <input type="text" id="progTitle" class="w-full border-2 p-3 rounded-lg border-gray-200">
        </div>

        <div class="flex justify-between items-center mb-6 bg-blue-50 p-4 rounded-lg border border-blue-100">
            <p class="text-sm font-bold text-blue-900 uppercase">Status Kehadiran: <span id="statPercent">0%</span></p>
            <button onclick="showAttendanceList()" class="bg-blue-800 text-white px-6 py-2 rounded-full font-bold text-xs uppercase">Isi Kehadiran</button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <input type="date" id="progDate" class="border-2 p-3 rounded-lg border-gray-200">
            <select id="progDay" class="border-2 p-3 rounded-lg border-gray-200">
                <option>Isnin</option><option>Selasa</option><option>Rabu</option><option>Khamis</option><option>Jumaat</option>
            </select>
            <input type="text" id="progTime" placeholder="Masa (Cth: 2-4 PM)" class="border-2 p-3 rounded-lg border-gray-200">
        </div>

        <input type="text" id="progPlace" placeholder="Tempat Aktiviti" class="w-full border-2 p-3 rounded-lg border-gray-200 mb-4">
        <input type="text" id="progAdvisor" placeholder="Nama Guru Penasihat" class="w-full border-2 p-3 rounded-lg border-gray-200 mb-4">
        
        <textarea id="progObj" placeholder="Objektif" class="w-full border-2 p-3 rounded-lg border-gray-200 mb-4"></textarea>
        <textarea id="progAct" placeholder="Ringkasan Aktiviti" rows="4" class="w-full border-2 p-3 rounded-lg border-gray-200 mb-4"></textarea>
        <textarea id="progReflect" placeholder="Refleksi" class="w-full border-2 p-3 rounded-lg border-blue-200 bg-blue-50 mb-6"></textarea>

        <div class="mb-8">
            <label class="block text-xs font-bold text-gray-500 mb-2 uppercase">Muat Naik Gambar (Maks 4)</label>
            <input type="file" id="imageInput" multiple accept="image/*" class="w-full text-sm">
        </div>

        <button onclick="generateFullReport()" class="w-full bg-blue-900 text-amber-400 font-bold py-4 rounded-xl text-xl shadow-lg uppercase">Jana Laporan</button>
    </div>

    <div id="reportSection" class="hidden">
        <div class="luxury-frame page-break">
            <div class="text-center mb-4">
                <img src="https://i.postimg.cc/kVCz4Wgj/logo-sk-kepangian.png" alt="Logo" class="mx-auto w-20 mb-2">
                <h2 class="text-2xl font-bold text-blue-900 uppercase">Laporan Perjumpaan Kokurikulum</h2>
                <p class="text-[10px] font-bold text-amber-800 tracking-widest">SK KEPANGIAN RANAU</p>
                <div class="border-t-2 border-blue-900 w-48 mx-auto mt-2"></div>
            </div>
            <table class="report-table">
                <tr><th width="30%">Unit</th><td id="rUnit" class="font-bold"></td></tr>
                <tr><th>Tajuk Aktiviti</th><td id="rTitle" class="font-bold uppercase"></td></tr>
                <tr><th>Kali Ke / Tarikh</th><td><span id="rMeetingNum"></span> / <span id="rDateTime"></span></td></tr>
                <tr><th>Masa / Tempat</th><td><span id="rTime"></span> / <span id="rPlace"></span></td></tr>
                <tr><th>Guru Penasihat</th><td id="rAdvisor" class="uppercase"></td></tr>
                <tr><th>Kehadiran</th><td id="rAttend" class="font-bold"></td></tr>
                <tr><th>Objektif</th><td id="rObj"></td></tr>
                <tr><th>Aktiviti</th><td id="rAct" class="whitespace-pre-line"></td></tr>
                <tr><th class="italic text-blue-700">Refleksi</th><td id="rReflect" class="italic bg-blue-50"></td></tr>
            </table>
            <div id="rImages" class="image-grid"></div>
        </div>

        <div class="luxury-frame">
            <h3 class="text-center font-bold underline mb-4 uppercase">Lampiran Kehadiran Murid</h3>
            <table class="w-full border-collapse border-2 border-black text-xs">
                <thead>
                    <tr class="bg-slate-100">
                        <th class="border border-black p-2 w-10">Bil</th>
                        <th class="border border-black p-2 text-left">Nama Penuh</th>
                        <th class="border border-black p-2 w-10">Thn</th>
                        <th class="border border-black p-2 w-16 text-center">Hadir</th>
                    </tr>
                </thead>
                <tbody id="rAttendanceTable"></tbody>
            </table>
        </div>

        <div class="max-w-4xl mx-auto no-print p-8 bg-amber-50 rounded-2xl border-2 border-amber-200 mb-10 text-center">
            <h3 class="font-bold text-amber-900 mb-4 uppercase">Laporan Sedia! Sila pilih tindakan:</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <button onclick="window.print()" class="bg-green-600 text-white font-bold py-4 rounded-xl shadow hover:bg-green-700 uppercase">
                    üì• Download (Simpan PDF)
                </button>
                <div class="flex flex-col gap-2">
                    <input type="file" id="pdfUploadInput" accept="application/pdf" class="text-xs">
                    <button onclick="uploadPdfToDrive()" id="pdfBtn" class="bg-blue-600 text-white font-bold py-4 rounded-xl shadow hover:bg-blue-700 uppercase">
                        üöÄ Upload Fail ke Drive
                    </button>
                </div>
            </div>
            <p id="pdfStatus" class="mt-2 text-xs font-bold uppercase"></p>
            <button onclick="location.reload()" class="mt-6 text-slate-500 text-xs underline uppercase">Buat Laporan Baru</button>
        </div>
    </div>

    <div id="attendanceModal" class="fixed inset-0 bg-black/60 hidden flex items-center justify-center no-print z-50 p-4">
        <div class="bg-white p-6 rounded-2xl w-full max-w-lg max-h-[80vh] overflow-y-auto">
            <h3 class="font-bold text-lg mb-4 text-blue-900 border-b pb-2">SENARAI NAMA MURID</h3>
            <div id="namesList" class="space-y-2"></div>
            <button onclick="closeModal()" class="mt-6 w-full bg-green-700 text-white py-3 rounded-xl font-bold uppercase">Selesai</button>
        </div>
    </div>

    <script>
        const database = {
            pengakap: [{n: "MOHD AYDEN", k: "3"}, {n: "NAURA", k: "3"}, {n: "SHE RIEYANA", k: "3"}, {n: "ARYA ARIANA", k: "3"}, {n: "STEFEN", k: "3"}, {n: "Fredyano Owen Fredoline", k: "4"}, {n: "Drakee Beilyrone", k: "4"}, {n: "Michorward Courve Clarence", k: "4"}, {n: "Ezraleo Edward Micklos", k: "4"}, {n: "Elysia Juidi", k: "4"}, {n: "Freshly Vallent Hezrin", k: "4"}, {n: "Dynaline Saidin", k: "4"}, {n: "Alver Aiseiro Indro", k: "5"}, {n: "Melbourne Maddox Mitchel", k: "5"}, {n: "QAMARUL HAFIZ BIN MOHD QUDDUS", k: "5"}, {n: "Dasewentworth Clarence", k: "6"}, {n: "Nelvin Nefrison Naire", k: "6"}],
            bsmm: [{n: "YORICOLEE", k: "3"}, {n: "IRMAYSARAH", k: "3"}, {n: "CHRISTAL", k: "3"}, {n: "ANGENI", k: "3"}, {n: "ALFAN", k: "3"}, {n: "CALVIN", k: "3"}, {n: "Arenley Adrell Elerry Roye", k: "4"}, {n: "Mohd Al Wafiq Afiq Abdullah", k: "4"}, {n: "Muhd Zaal Syahkiz Abdullah", k: "4"}, {n: "Afiqah Azanney Rezileh", k: "4"}, {n: "Haziedah", k: "4"}, {n: "Eve Elsie Hilary", k: "4"}, {n: "Dympna Eunah Selverius", k: "4"}, {n: "Herra Reverra Rajan", k: "5"}, {n: "Aiver Aiseiro Indro", k: "5"}, {n: "Dareen Beilyrone", k: "6"}, {n: "Deyanna Emerry Selverius", k: "6"}, {n: "Nur Syaidatul Syafina Isna Artis", k: "6"}, {n: "Crystalinna Dady@Jaidy", k: "6"}],
            tkrs: [{n: "EZROY", k: "3"}, {n: "AMERA", k: "3"}, {n: "AMBER", k: "3"}, {n: "QUENCYNOVIC", k: "3"}, {n: "NEKHO", k: "3"}, {n: "Fidel Marchel Fazly", k: "4"}, {n: "Nevier Chirst Naire", k: "4"}, {n: "Adam Christdec Hendry", k: "4"}, {n: "Fasha Vanessa Jinus", k: "4"}, {n: "Eva Eliza Hilary", k: "4"}, {n: "Riana Saibit", k: "4"}, {n: "Glenn Dilton George", k: "5"}, {n: "Wellen Alex Nor Vejy", k: "5"}, {n: "Scha Avarella Larry", k: "6"}, {n: "Aldree K.Lorince", k: "6"}, {n: "Junior Adrian Jidak", k: "6"}, {n: "Amber Eve Cristalova Anthony", k: "6"}, {n: "Ardila Jonen", k: "6"}, {n: "Syeldia Ridyana Sem", k: "6"}],
            badminton: [{n: "YORICOLEE", k: "3"}, {n: "NAURA", k: "3"}, {n: "AMBER", k: "3"}, {n: "ANGENI", k: "3"}, {n: "ALFAN", k: "3"}, {n: "Arenley Adriell Elerry Roye", k: "4"}, {n: "Mohd Al Wafiq Afiq Abdullah", k: "4"}, {n: "Michorward Courve Clerance", k: "4"}, {n: "Elysia Juidi", k: "4"}, {n: "Afiqah Azianney Rezileh", k: "4"}, {n: "Dynaline Saidin", k: "4"}, {n: "Herra Reverra Rajan", k: "5"}, {n: "Alver Aiseiro Indro", k: "5"}, {n: "Ardila Jonen", k: "6"}, {n: "Adrian Junior Jidak", k: "6"}, {n: "Deyana Emerry Selverius", k: "6"}, {n: "Adlree K.Lorince", k: "6"}, {n: "Shelydia Ridyana Sem", k: "6"}],
            bola_baling: [{n: "MOHD AYDEN", k: "3"}, {n: "AMERA", k: "3"}, {n: "SHE RIEYANA", k: "3"}, {n: "ARYA ARIANA", k: "3"}, {n: "NEKHO", k: "3"}, {n: "Fidel Marchel Fazly", k: "4"}, {n: "Nevier Christ Naire", k: "4"}, {n: "Drakee Beilyrone", k: "4"}, {n: "Ezraleo Edward Micklos", k: "4"}, {n: "Fasha Vanessa Jinus", k: "4"}, {n: "Freshly Vallent Hezrin", k: "4"}, {n: "Riana Saibit", k: "4"}, {n: "Glenn Dilton George", k: "5"}, {n: "QAMARUL HAFIZ BIN MOHD QUDDUS", k: "5"}, {n: "Dase Wentworth Clarence", k: "6"}, {n: "Nelven Neffrison Naire", k: "6"}, {n: "Amber Eve Cristalova Anthony", k: "6"}, {n: "Scha Avariella Larry", k: "6"}],
            catur: [{n: "EZROY", k: "3"}, {n: "IRMAYSARAH", k: "3"}, {n: "CHRISTAL", k: "3"}, {n: "QUENCYNOVIC", k: "3"}, {n: "STEFEN", k: "3"}, {n: "CALVIN", k: "3"}, {n: "Fredayanon Owen Fredoline", k: "4"}, {n: "Mohd Zaal Syahkiz Abdullah", k: "4"}, {n: "Adam Christdec Hendry", k: "4"}, {n: "Eva Eliza Hilary", k: "4"}, {n: "Haziedah", k: "4"}, {n: "Eve Elsie Hilary", k: "4"}, {n: "Dympna Eunah Selverius", k: "4"}, {n: "Avionna Michelle Clarence", k: "4"}, {n: "Wallen Alex Nor Vejy", k: "5"}, {n: "Mealbourne Maddox Mitchel", k: "5"}, {n: "Dareen Beilyrone", k: "6"}, {n: "Nur Shaidatul Shafina Isna Artis", k: "6"}, {n: "Crystalinna Dady@Jaidy", k: "6"}, {n: "Micheel Ajum", k: "6"}],
            bm: [{n: "MOHD AYDEN", k: "3"}, {n: "IRMAYSARAH", k: "3"}, {n: "SHE RIEYANA", k: "3"}, {n: "ARYA ARIANA", k: "3"}, {n: "NEKHO", k: "3"}, {n: "Drake Beilyrone", k: "4"}, {n: "Adam Chrisdec Hendry", k: "4"}, {n: "Avionna Michelle Binti Rolance", k: "4"}, {n: "Nevier Christ Naire", k: "4"}, {n: "Afiqah Azzanney Binti Rezileh", k: "4"}, {n: "Elysia Juidi", k: "4"}, {n: "Dynaline Saidin", k: "4"}, {n: "Melbourne Maddox", k: "5"}, {n: "Herra Reverra Rajan", k: "5"}, {n: "Shelydia Ridyana Sem", k: "6"}, {n: "Dase wentworth Clarence", k: "6"}, {n: "Darren Beilyrone", k: "6"}, {n: "Micheel Ajum", k: "6"}],
            bi: [{n: "YORICOLEE", k: "3"}, {n: "AMERA", k: "3"}, {n: "CHRISTAL", k: "3"}, {n: "ANGENI", k: "3"}, {n: "ALFAN", k: "3"}, {n: "Fredano Owen Fredoline", k: "4"}, {n: "Riana Saibit", k: "4"}, {n: "Ezraleo Edward Micklos", k: "4"}, {n: "Fasha Vanassa Jinus", k: "4"}, {n: "Fidel Marchel Fazly", k: "4"}, {n: "Haeziedah", k: "4"}, {n: "Michoward Courve Clarence", k: "4"}, {n: "Wallent", k: "5"}, {n: "Scha Aravilla Larry", k: "6"}, {n: "Aldree K.Lorince", k: "6"}, {n: "Amber Cristalova Anthony", k: "6"}, {n: "Emmerry Dyannah Selverius", k: "6"}],
            stem: [{n: "EZROY", k: "3"}, {n: "NAURA", k: "3"}, {n: "AMBER", k: "3"}, {n: "QUENCYNOVIC", k: "3"}, {n: "STEFEN", k: "3"}, {n: "CALVIN", k: "3"}, {n: "Arenley Adriell Elerry Roye", k: "4"}, {n: "Freshly Vellant Hezrin", k: "4"}, {n: "Mohd Zaal Syahkiz bin Abdullah", k: "4"}, {n: "Eva Eliza Hilary", k: "4"}, {n: "Eve Elsie Hilary", k: "4"}, {n: "Dympna Eunah Silverius", k: "4"}, {n: "Mohd Al Wafiq Afiq bin Abdullah", k: "4"}, {n: "Gleen Dilton George", k: "5"}, {n: "Alver Aiseiro Indro", k: "5"}, {n: "Adrian Junior Jidak", k: "6"}, {n: "Nelven Neffrison Naire", k: "6"}, {n: "Nur Shafina", k: "6"}, {n: "Ardila Jonen", k: "6"}, {n: "Crystalinna Dady@JAidy", k: "6"}]
        };

        let selectedAttendance = [];

        function showAttendanceList() {
            const unit = document.getElementById('unitSelect').value;
            if(!unit) return alert("Pilih unit!");
            const list = document.getElementById('namesList');
            list.innerHTML = '';
            database[unit].forEach((m, idx) => {
                const checked = selectedAttendance.includes(m.n) ? 'checked' : '';
                list.innerHTML += `<div class="flex items-center gap-3 p-2 border-b"><input type="checkbox" value="${m.n}" ${checked} onchange="updateStats()" class="w-5 h-5"><label>${m.n} (T${m.k})</label></div>`;
            });
            document.getElementById('attendanceModal').classList.remove('hidden');
        }

        function updateStats() {
            const checks = document.querySelectorAll('#namesList input:checked');
            selectedAttendance = Array.from(checks).map(c => c.value);
            const unit = document.getElementById('unitSelect').value;
            const total = database[unit].length;
            const percent = ((selectedAttendance.length / total) * 100).toFixed(0);
            document.getElementById('statPercent').innerText = percent + "%";
        }

        function closeModal() { document.getElementById('attendanceModal').classList.add('hidden'); }
        function resetAttendance() { selectedAttendance = []; document.getElementById('statPercent').innerText = "0%"; }

        function generateFullReport() {
            const unit = document.getElementById('unitSelect').value;
            if(!unit) return alert("Pilih unit dahulu!");

            // Isi Data
            document.getElementById('rUnit').innerText = document.getElementById('unitSelect').options[document.getElementById('unitSelect').selectedIndex].text;
            document.getElementById('rTitle').innerText = document.getElementById('progTitle').value;
            document.getElementById('rMeetingNum').innerText = "PERJUMPAAN KALI KE-" + document.getElementById('meetingNum').value;
            document.getElementById('rDateTime').innerText = document.getElementById('progDate').value + " (" + document.getElementById('progDay').value + ")";
            document.getElementById('rTime').innerText = document.getElementById('progTime').value;
            document.getElementById('rPlace').innerText = document.getElementById('progPlace').value;
            document.getElementById('rAdvisor').innerText = document.getElementById('progAdvisor').value;
            document.getElementById('rAttend').innerText = `${selectedAttendance.length} / ${database[unit].length} (${document.getElementById('statPercent').innerText})`;
            document.getElementById('rObj').innerText = document.getElementById('progObj').value;
            document.getElementById('rAct').innerText = document.getElementById('progAct').value;
            document.getElementById('rReflect').innerText = document.getElementById('progReflect').value;

            // Lampiran Kehadiran
            const tableBody = document.getElementById('rAttendanceTable');
            tableBody.innerHTML = '';
            database[unit].forEach((m, i) => {
                tableBody.innerHTML += `<tr><td class="border border-black p-2 text-center">${i+1}</td><td class="border border-black p-2 font-bold">${m.n}</td><td class="border border-black p-2 text-center">${m.k}</td><td class="border border-black p-2 text-center font-bold text-lg">${selectedAttendance.includes(m.n) ? '/' : ''}</td></tr>`;
            });

            // Gambar
            const files = document.getElementById('imageInput').files;
            const imgContainer = document.getElementById('rImages');
            imgContainer.innerHTML = '';
            Array.from(files).slice(0,4).forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => { imgContainer.innerHTML += `<img src="${e.target.result}">`; }
                reader.readAsDataURL(file);
            });

            // Tukar Paparan
            document.getElementById('inputForm').classList.add('hidden');
            document.getElementById('reportSection').classList.remove('hidden');
            window.scrollTo(0,0);
        }

        function uploadPdfToDrive() {
            const fileInput = document.getElementById('pdfUploadInput');
            const status = document.getElementById('pdfStatus');
            const btn = document.getElementById('pdfBtn');
            const URL = "https://script.google.com/macros/s/AKfycbzOIqF-vPXB1vn8DnzKhmhkCE8m7C-wydF16JKsv0FKCEyE6thbyhU6YRpuQRkkaVM1/exec";

            if (fileInput.files.length === 0) return alert("Pilih fail PDF yang telah disimpan!");

            status.innerText = "‚è≥ Sedang upload...";
            btn.disabled = true;

            const file = fileInput.files[0];
            const reader = new FileReader();
            reader.onload = function(e) {
                const base64 = e.target.result.split(',')[1];
                fetch(URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ base64: base64, contentType: file.type, fileName: file.name }) })
                .then(() => { status.innerText = "‚úÖ Berjaya!"; btn.disabled = false; })
                .catch(() => { status.innerText = "‚ùå Gagal!"; btn.disabled = false; });
            };
            reader.readAsDataURL(file);
        }
    </script>
</body>
</html>
